
# Arquitectura de las aplicaciones Spring MVC

Spring Web MVC es un framework diseñado alrededor de un `DispatcherServlet` que atiende las solicitudes de los requests a los manejadores, con handler mappings configurables, resolución de vistas, localización, y resolución de temas, así como el soporte de upload de archivos. Desde Spring 2.5 y reforzado en 3.0, el manejador por default está basado en anotaciones como `@Controller` y `@RequestMapping`, ofreciendo un ampli rango de firmas de métodos. Adicionalmente, desde Spring 3, el uso de anotaciones como `@PathVariable` permiten crear sitios RESTful.

NOTE: SpringMVC esta basado en el principio: Open For extension, Close for modification.

En SpringMVC se puede usar cualquier objeto como un _command_ o un _form-backing_ object; no se necesitan implementar interfaces específicas del framework o heredar de algo. El binding(atado) de datos es altamente flexible, Spring hace las conversiones y tratamientos de los tipos que conforman la estructura del objeto.

La resolución de vistas de Spring es extremadamente flexible. Un `Controller` es tipicamente responsable de preparar un modelo en un `Map` y seleccionando un nombre de vista, aunque se podría escribir directamente al flujo del response para completar el request. La resolución de vistas es muy configurable y flexible, ya sea a través de beans de Spring o los encabezados del request. Se puede integrar directamente con tecnologías como JSP, Velocity, Freemarker, o generar directamente XML y JSON, o bien, generar hojas de cálculo.

## Características de SpringMVC

* Clara separación de roles
* Configuración poderosa y directa del MVC y las clases de la aplicación como JavaBeans
* Adaptabilidad, sin ser invasivo, y flexible
* Código de negocio reusable, evitando la duplicación
* Binding personalizable en conjunto con validaciones
* Manejadores de mapeos y resolución de vistas personalizables
* Transferencia de modelos flexibles hacia las vistas
* Internacionalización y resolución de temas personalizable, con soporte àra JSP’s con o sin las librerías de tags de Spring
* Una librería de tags simple y poderosa que provee de características como data _binding_, temas, y generación de formularios mas fáciles de describir
* Beans cuyo ciclo de vida está en el alcance del request actual HTTP o del objeto `Session`

## Recomendaciones para entrar con SpringMVC

* La capa de servicio debe ser transaccional
* Cuando una operación de un Dao de Hibernate o JDBC falle la excepción debe ser trasladada
* Los objetos de la capa de servicio no deben llamar a la capa Web
* Un servicio de negocio que falla con una concurrencia relacionada puede ser reintentado

*DispatcherServlet*

image:images/dispatcher_servlet.png[]

*web.xml*
[source,xml,linenums]
----
<web-app xmlns="http://java.sun.com/xml/ns/javaee" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd"
  version="3.0">

  <servlet>
    <servlet-name>trackbox</servlet-name>
    <servlet-class>org.springframework.web.servlet.DispatcherServlet</servlet-class>
    <load-on-startup>1</load-on-startup>
  </servlet>

  <servlet-mapping>
    <servlet-name>trackbox</servlet-name>
    <url-pattern>/</url-pattern>
  </servlet-mapping>

  <!--
    Deshabilita en el contenedor de Servlet el manejo de archivo de
    bienvenida. Necesario para la compatibilidad con Servlet 3.0 y Tomcat
    7.0
  -->
  <welcome-file-list>
    <welcome-file></welcome-file>
  </welcome-file-list>

</web-app>
----

*MyWebApplicationInitializer.java*
[source,java,linenums]
----
package com.makingdevs.practica1;

import javax.servlet.ServletContext;
import javax.servlet.ServletException;
import javax.servlet.ServletRegistration;

import org.springframework.web.WebApplicationInitializer;
import org.springframework.web.context.support.XmlWebApplicationContext;
import org.springframework.web.servlet.DispatcherServlet;

public class MyWebApplicationInitializer implements WebApplicationInitializer {

  @Override
  public void onStartup(ServletContext servletContext) throws ServletException {
    XmlWebApplicationContext appContext = new XmlWebApplicationContext();
    appContext.setConfigLocation("/WEB-INF/spring/dispatcher-config.xml");

    ServletRegistration.Dynamic registration = servletContext.addServlet("dispatcher", new DispatcherServlet(appContext));
    registration.setLoadOnStartup(1);
    registration.addMapping("/");
  }

}
----

* `DispatcherServlet` es un simple Servlet que hereda de HttpServlet y por lo tanto hay que definirla en el descriptor web.xml
* Cada `DispatcherServlet` tiene su propio `ApplicationContext`, a este se le denomina `WebApplicationContext`
* Tras la inicialización del `DispatcherServlet`, por convención el framework busca por un archivo con la notación: `{nombre_del_servlet}-servlet.xml`, que se debe de ubicar dentro del directorio WEB-INF de la aplicación
* Este archivo contiene todos los Beans de configuración del MVC
* El `DispatcherServlet` cuenta con las siguientes propiedades:
** `contextClass` - Clase que implementa el WebAppCtx, usada por el Servlet. Default: XmlWebApplicationContext
** `contextConfigLocation` - Indica donde se puede encontrar la configuración del Servle
** `namespace` - Namespace del WebAppCtx. Default: {nombre-del-servlet}-servlet

TIP: Te recomendamos profundizar en la documentación del Dispatcher Servlet de Spring, así conocerás de forma más detallada cuál es el alcance de la configuración que puedes hacer.
